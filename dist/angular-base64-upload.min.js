!function(e){"use strict";e._arrayBufferToBase64=function(n){for(var t="",r=new Uint8Array(n),a=r.byteLength,i=0;i<a;i++)t+=String.fromCharCode(r[i]);return e.btoa(t)},e.angular.module("naif.base64",[]).directive("baseSixtyFourInput",["$window","$q",function(e,n){for(var t={onChange:"&",onAfterValidate:"&",parser:"&"},r=["onabort","onerror","onloadstart","onloadend","onprogress","onload"],a=r.length-1;a>=0;a--)t[r[a]]="&";return{restrict:"A",require:"ngModel",scope:t,link:function(t,a,i,o){function l(e){if(i.maxnum&&i.multiple&&e){var n=e.length<=parseInt(i.maxnum);o.$setValidity("maxnum",n)}return e}function f(e){if(i.minnum&&i.multiple&&e){var n=e.length>=parseInt(i.minnum);o.$setValidity("minnum",n)}return e}function u(e){var n=!0;if(i.maxsize&&e){var t=1e3*parseFloat(i.maxsize);if(i.multiple)for(var r=0;r<e.length;r++){var a=e[r];if(a.filesize>t){n=!1;break}}else n=e.filesize<=t;o.$setValidity("maxsize",n)}return e}function s(e){var n=!0,t=1e3*parseFloat(i.minsize);if(i.minsize&&e){if(i.multiple)for(var r=0;r<e.length;r++){var a=e[r];if(a.filesize<t){n=!1;break}}else n=e.filesize>=t;o.$setValidity("minsize",n)}return e}function c(e){var n,t,r,a=!0;if(i.accept&&(t=i.accept.trim().replace(/[,\s]+/gi,"|").replace(/\./g,"\\.").replace(/\/\*/g,"/.*"),n=new RegExp(t)),i.accept&&e){if(i.multiple)for(var l=0;l<e.length;l++){var f=e[l];if(r="."+f.filename.split(".").pop(),!(a=n.test(f.filetype)||n.test(r)))break}else r="."+e.filename.split(".").pop(),a=n.test(e.filetype)||n.test(r);o.$setValidity("accept",a)}return e}function p(){var e=i.multiple?b:b[0];o.$setViewValue(e),u(e),s(e),l(e),f(e),c(e)}function d(e,n,t,r,a){t[e]=function(e){n()(e,t,r,z,b,a)}}function m(r,a,o){return function(l){var f,u=l.target.result,s=i.maxsize&&a.size>1024*i.maxsize;void 0!==i.doNotParseIfOversize&&s?o.base64=null:o.base64=e._arrayBufferToBase64(u),f=i.parser?n.when(t.parser()(a,o)):n.when(o),f.then(function(e){b.push(e),a.deferredObj.resolve()}),i.onload&&(t.onload&&"function"==typeof t.onload()?t.onload()(l,r,a,z,b,o):t.onload(l,z))}}function g(e,n,a){for(var o=r.length-1;o>=0;o--){var l=r[o];i[l]&&"onload"!==l&&d(l,t[l],e,n,a)}e.onload=m(e,n,a)}function h(){var t,r=[];for(t=z.length-1;t>=0;t--)z[t].deferredObj=n.defer(),r.push(z[t].deferredObj.promise);for(n.all(r).then(p),t=z.length-1;t>=0;t--){var a=new e.FileReader,i=z[t],o={};o.filetype=i.type,o.filename=i.name,o.filesize=i.size,g(a,i,o),a.readAsArrayBuffer(i)}}function v(e){i.onChange&&(t.onChange&&"function"==typeof t.onChange()?t.onChange()(e,z):t.onChange(e,z))}function y(e){if(i.onAfterValidate){for(var r=[],a=z.length-1;a>=0;a--)r.push(z[a].deferredObj.promise);n.all(r).then(function(){t.onAfterValidate&&"function"==typeof t.onAfterValidate()?t.onAfterValidate()(e,b,z):t.onAfterValidate(e,b,z)})}}var z=[],b=[];o&&(o.$isEmpty=function(e){return!e||(angular.isArray(e)?0===e.length:!e.base64)},t._clearInput=function(){a[0].value=""},t.$watch(function(){return o.$viewValue},function(e){o.$isEmpty(e)&&t._clearInput()}),a.on("change",function(e){e.target.files.length&&(b=[],b=angular.copy(b),z=e.target.files,h(),v(e),y(e))}))}}}])}(window);
//# sourceMappingURL=angular-base64-upload.min.js.map
